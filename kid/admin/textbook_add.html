<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>教材添加页</title>
    <link href="less/Nstrap.less" type="text/css" rel="stylesheet/less"/>
    <script src="js/less.js"></script>
    <!--[if lt IE 9]>
    <script src="http://apps.bdimg.com/libs/html5shiv/3.7/html5shiv.min.js"></script>
    <script src="http://apps.bdimg.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link href="js/Validform_v5.3.2/Validform_v5.3.2/demo/css/style.css" type="text/css" rel="stylesheet">
    <link href="js/uniform-master/themes/default/css/uniform.default.css" type="text/css" rel="stylesheet">
    <link href="js/select2-master/css/select2.css" type="text/css" rel="stylesheet">

    <link href="js/layer/lay/layer/skin/layer.css" type="text/css" rel="stylesheet">
    <link href="js/colorpicker/css/bootstrap-colorpicker.min.css" type="text/css" rel="stylesheet">
</head>
<body>
<div class="console-container">
    <div class="row">
        <div class="col-sm-12">
            <div class="console-title clearfix">
                <div class="pull-left"> <h5>添加产品</h5></div>
                <div class="pull-right"><a href="textbook_list.html" class="btn btn-link">返回教材列表</a> </div>
            </div>
            <hr/>
            <div class="mask-con">
                <ul class="nav nav-tabs">
                    <li role="presentation" class="active"><a href="textbook_add.html">基本信息</a></li>
                    <li role="presentation"><a href="textbook_chapters_add.html">章节设置</a></li>
                </ul>
            </div>
            <hr class="hr">

            <form class="form-horizontal">
                <div class="panel panel-default">
                    <div class="panel-heading">基本信息</div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">教材名称：</label>
                            <div class="col-sm-5 num-box">
                                <input type="text" class="form-control" id="T_title" onkeyup="cls(this,50,'Btitle')" oncontextmenu="cls(this,50,'Btitle')" placeholder="文章标题至少6个字符,最多25个汉字" datatype="s6-18" errormsg="文章标题至少6个字符,最多25个汉字！" nullmsg="文章标题不能为空！"/>
                                <div class="num-count"><span class="num-hint" id="Btitle">50</span> / 50</div>
                            </div>
                            <label for="" class="col-sm-2 control-label">编号：</label>
                            <div class="col-sm-2">
                                <input type="text" class="form-control" placeholder="若是远程图片请在文本框内填写远程图片地址">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">教材封面：</label>
                            <div class="col-sm-4">
                                <div class="input-group">
                                    <input type="text" id="fileName" class="form-control" placeholder="若是远程图片请在文本框内填写远程图片地址">
                                    <div class="input-group-btn">
                                        <button type="button" class="btn btn-default" data-id="upImg">本地上传</button>
                                        <button type="button" class="btn btn-default" data-id="imgGroup">站内选择</button>
                                        <button type="button" class="btn btn-default" data-id="imgEdit">裁剪图片</button>
                                    </div>
                                </div><!-- /input-group -->
                            </div>
                            <div class="col-sm-2">
                                <button type="button" class="btn btn-default" data-id="imgShow">查看图片</button>
                                <input id="imageInput" type="file" data-id='file' name="myPhoto" onchange="loadImageFile()" class="hide" />
                                <div id="imagePreview" class="" style="width:0px; height: 0px; overflow: hidden; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale);"> </div>
                                <span data-style="width" class="hide"></span><span data-style="height" class="hide"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">所属学段：</label>
                            <div class="col-sm-3">
                                <div class="form-inline">
                                    <select class="form-control" id="" datatype="*" nullmsg="请选择所属栏目" errormsg="请选择所属栏目">
                                        <option></option>
                                        <option value="1">小学</option>
                                        <option value="2">初中</option>
                                        <option value="3">高中</option>
                                    </select>
                                    <select class="form-control" id="" datatype="*" nullmsg="请选择所属栏目" errormsg="请选择所属栏目">
                                        <option></option>
                                        <option value="1">一年级</option>
                                        <option value="2">二年级</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                            </div>
                            <label for="" class="col-sm-2 control-label">学期：</label>
                            <div class="col-sm-2">
                                <select class="form-control" id="" datatype="*" nullmsg="请选择所属栏目" errormsg="请选择所属栏目">
                                    <option></option>
                                    <option value="1">上学期</option>
                                    <option value="2">下学期</option>
                                    <option value="3">全学期</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">所属科目：</label>
                            <div class="col-sm-3">
                                <select class="form-control" id="" datatype="*" nullmsg="请选择所属栏目" errormsg="请选择所属栏目">
                                    <option></option>
                                    <option value="1">语文</option>
                                    <option value="2">数学</option>
                                    <option value="3">英语</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                            <label for="" class="col-sm-2 control-label">所属版本：</label>
                            <div class="col-sm-2">
                                <select class="form-control" id="" datatype="*" nullmsg="请选择所属栏目" errormsg="请选择所属栏目">
                                    <option></option>
                                    <option value="1">人教版</option>
                                    <option value="2">数学</option>
                                    <option value="3">英语</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">版次：</label>
                            <div class="col-sm-3">
                                <div class="input-group">
                                    <input type="text" id="fileName" class="form-control" placeholder="若是远程图片请在文本框内填写远程图片地址">
                                    <div class="input-group-btn">
                                        <button type="button" class="btn btn-default" >选择</button>
                                    </div>
                                </div><!-- /input-group -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">出版社：</label>
                            <div class="col-sm-3">
                                <select class="form-control" id="" datatype="*" nullmsg="请选择所属栏目" errormsg="请选择所属栏目">
                                    <option></option>
                                    <option value="1">人教版</option>
                                    <option value="2">数学</option>
                                    <option value="3">英语</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">发行号：</label>
                            <div class="col-sm-3">
                                <div class="input-group">
                                    <input type="text" id="fileName" class="form-control" placeholder="若是远程图片请在文本框内填写远程图片地址">
                                    <div class="input-group-btn">
                                        <button type="button" class="btn btn-default" >选择</button>
                                    </div>
                                </div><!-- /input-group -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">开本：</label>
                            <div class="col-sm-3">
                                <input type="text" id="fileName" class="form-control" placeholder="若是远程图片请在文本框内填写远程图片地址">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">出版时间：</label>
                            <div class="col-sm-3">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="datetime" placeholder="发布时间" >
                                    <div class="input-group-btn"><button type="button" date-id="datetime" class="btn btn-default"><i class="fa fa-calendar-o"></i> </button></div>
                                </div><!-- /input-group -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">类型：</label>
                            <div class="col-sm-3">
                                <select class="form-control" id="" datatype="*" nullmsg="请选择所属栏目" errormsg="请选择所属栏目">
                                    <option></option>
                                    <option value="1">必修</option>
                                    <option value="2">选修</option>
                                    <option value="3">英语</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">字数：</label>
                            <div class="col-sm-3">
                                <input type="text" id="fileName" class="form-control" placeholder="若是远程图片请在文本框内填写远程图片地址">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">页数：</label>
                            <div class="col-sm-3">
                                <input type="text" id="fileName" class="form-control" placeholder="若是远程图片请在文本框内填写远程图片地址">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">关键词：</label>
                            <div class="col-sm-5">
                                <input type="text" class="form-control"  placeholder="自动获取，手动填写用‘,’分开">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">描述：</label>
                            <div class="col-sm-9 num-box">
                                <textarea class="form-control" onkeyup="cls(this,200,'v')" oncontextmenu="cls(this,200,'v')" rows="2" placeholder="最多不超过100个汉字"></textarea>
                                <div class="num-count bottom"><span class="num-hint" id="v">200</span> / 200</div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="panel panel-default">
                    <div class="panel-heading">高级设置</div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">权限：</label>
                            <div class="col-sm-3">
                                <select class="form-control" data-select="default">
                                    <option>开放浏览</option><option>等待审核</option><option>注册会员</option><option>中级会员</option><option>高级会员</option><option>给力会员</option>
                                </select>
                            </div>
                            <label for="" class="col-sm-2 control-label">排序：</label>
                            <div class="col-sm-3">
                                <input type="text" class="form-control"  placeholder="自动获取，手动填写用‘,’分开">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">发布时间：</label>
                            <div class="col-sm-3">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="datetime" placeholder="发布时间" >
                                    <div class="input-group-btn"><button type="button" date-id="datetime" class="btn btn-default"><i class="fa fa-calendar-o"></i> </button></div>
                                </div><!-- /input-group -->
                            </div>
                        </div>

                    </div>
                </div>



                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" class="btn btn-primary" id="addBtn">确认发布</button>
                    </div>
                </div>
            </form>


        </div>
    </div>
</div>
</body>
<!-- 放在文件的末端，使页面加载速度更快 -->
<script src="http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<!-- 只是为了让我们的占位符图像工作。不要实际复制下一行！ -->
<script src="js/vendor/holder.js"></script>
<!-- IE10视口黑客的表面/桌面Windows 8的bug -->
<script src="js/ie10-viewport-bug-workaround.js"></script>
<script src="js/browser.js" type="text/javascript"></script>
<!-- 复选框，单选框，下拉选框美化 -->
<script src="js/uniform-master/jquery.uniform.js"></script>
<script src="js/select2-master/js/select2.js"></script>
<!-- 弹出层 -->
<script src="js/layer/layer/layer.js"></script>
<!-- 时间控件 -->
<script src="js/laydate/laydate.js"></script>
<script>
    $(document).ready(function() {

        //上传图片
        $("button[data-id='upImg']").click(function(){
            return $("#imageInput").click();
        });
        //查看图片，弹出图片层
        $("button[data-id='imgShow']").click(function(){
            if($("input[data-id='file']").val()!=""){
                $('#imagePreview img').css({"background":"#fff"})
                var imgWidth = ($('#imagePreview img').width()) + "px";
                var imgHeight = ($('#imagePreview img').height()) + "px";
                //alert($("#imagePreview img").attr("src"));
                layer.open({
                    type: 1,
                    title: false,
                    closeBtn: false,
                    area: [imgWidth, imgHeight],
                    skin: 'layui-layer-nobg', //没有背景色
                    shadeClose: true,
                    content: $('#imagePreview img')
                });
            }else{
                layer.msg('您还没有上传图片', function(){});
            }
        });
        //多图上传弹出层
        $("button[ data-img='upMore']").click(function(){
            //iframe层-禁滚动条
            layer.open({
                type: 2,
                area: ['1000px', '620px'],
                skin: 'layui-layer-rim', //加上边框
                content: ['webuploader.html', 'no']
            });
        });
        //改变复选框与单选框的样式
        $("input[type='radio'],input[type='checkbox']").uniform();
        $("#uniform-flagsj").bind("click",function(){
            if($(this).find("span").attr('class')==""){
                $("div[data-target='flagsj']").addClass("hide");
            }else{
                //do someting else
                $("div[data-target='flagsj']").removeClass("hide");
            }
        });

        //改变选择的样式
        $("select[data-select='default']").select2();
        $("#type-select").select2({
            placeholder: "请选择所属栏目",
            allowClear: true
        });
        //选择时间皮肤
        laydate.skin('molv');


        $("#addBtn").bind("click",function(){
            var reg=/[^x00-xff]/gm;
            var str=$("#T_title").val().replace(reg,'aa');//全换成单字节字符计算
            if($("#T_title").val()==""){
                layer.msg('文章标题不能为空', function(){}); return false
            }else if(str.length<6){
                layer.msg('文章标题不能少于6个字符', function(){}); return false
            }else{}
            if($("#flagsj").is(":checked")){
                console.log(IsURL($("div[data-target='flagsj'] input").val()));
                if(IsURL($("div[data-target='flagsj'] input").val())){

                }else{
                    layer.msg('请正确填写网址', function(){});return false
                }
            }
            if($("#type-select").val()=="" && $("#type-select").val()==0){layer.msg('栏目不能为空', function(){}); return false}else{}

        });

    });

    //单图上传图片后的事件
    var loadImageFile = (function () {
        if (window.FileReader) {
            var addinput = document.getElementById("fileName");
            var oPreviewImg = null, oFReader = new window.FileReader(),
                    rFilter = /^(?:image\/bmp|image\/cis\-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x\-cmu\-raster|image\/x\-cmx|image\/x\-icon|image\/x\-portable\-anymap|image\/x\-portable\-bitmap|image\/x\-portable\-graymap|image\/x\-portable\-pixmap|image\/x\-rgb|image\/x\-xbitmap|image\/x\-xpixmap|image\/x\-xwindowdump)$/i;


            oFReader.onload = function (oFREvent) {
                if (!oPreviewImg) {
                    var newPreview = document.getElementById("imagePreview");
                    oPreviewImg = new Image();
                    //oPreviewImg.style.height = (oPreviewImg.width).toString() + "px";
                    newPreview.appendChild(oPreviewImg);
                }
                oPreviewImg.src = oFREvent.target.result;
                addinput.value = document.getElementById("imageInput").value;
            };

            return function () {
                var aFiles = document.getElementById("imageInput").files;
                if (aFiles.length === 0) { return; }
                if (!rFilter.test(aFiles[0].type)) { alert("You must select a valid image file!"); return; }
                oFReader.readAsDataURL(aFiles[0]);
            }


        }
        if (navigator.appName === "Microsoft Internet Explorer") {
            return function () {
                alert(document.getElementById("imageInput").value);
                document.getElementById("imagePreview").filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = document.getElementById("imageInput").value;
            }
        }
    })();


    //外部js调用
    laydate({
        elem: '#datetime', //目标元素。由于laydate.js封装了一个轻量级的选择器引擎，因此elem还允许你传入class、tag但必须按照这种方式 '#id .class'
        event: 'focus' //响应事件。如果没有传入event，则按照默认的click
    });
    $("button[date-id='datetime']").click(function(){laydate({elem: '#datetime'})});

    //字节数计算
    function cls(obj,max,id){
        var reg=/[^x00-xff]/gm;
        var str=obj.value.replace(reg,'aa');//全换成单字节字符计算
        var v=document.getElementById(id);

        if(str.length>max){
            var n=0,strr=[];
            for(var i=0;i<obj.value.length;i++){//得到50字节以内的字符
                /[^x00-xff]/.test(obj.value.charAt(i))?n+=2:n+=1;
                if(n>max){layer.msg('只能输入'+max+'个字符', function(){});break;}
                strr.push(obj.value.charAt(i));
            }
            obj.value=strr.join('');
            v.innerHTML=0;
        }else{
            v.innerHTML=max-str.length;
        }
    }
</script>
</html>